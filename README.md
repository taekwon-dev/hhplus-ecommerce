# E-Commerce

íŒ¨ì…˜ ë¸Œëœë“œ í”Œë«í¼ì„ ìœ„í•œ E-Commerce ì„œë²„ë¥¼ ê°œë°œí•˜ê³ ì í•©ë‹ˆë‹¤ ğŸ™‚

[STEP11] ê³¼ì œ ë§í¬: https://stealth-metal-dd1.notion.site/STEP11-1838778b3259805b948eeeaa0b4f564b?pvs=4

----

## Business Requirements

- #### ìƒí’ˆ ì¡°íšŒ
  - ìœ ì €ëŠ” ìƒí’ˆ ëª©ë¡(ê°€ê²©, ì”ì—¬ìˆ˜ëŸ‰ ë“±)ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ìœ ì €ëŠ” ëœë”© í˜ì´ì§€ì—ì„œ ìµœê·¼ 3ì¼ ê°„ ê°€ì¥ ë§ì´ íŒ”ë¦° ìƒìœ„ 5ê°œ ìƒí’ˆ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- #### ê²°ì œ ê¸ˆì•¡ ì¶©ì „ / ì¡°íšŒ
  - ìœ ì €ëŠ” ê²°ì œ ì‹œ ì‚¬ìš©ë  ê¸ˆì•¡ì„ ì¶©ì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì¶©ì „ ê¸ˆì•¡ì€ ì›í™”ì™€ 1:1 ë¹„ìœ¨)
  - ìµœì†Œ ì¶©ì „ ê¸ˆì•¡ì€ 1,000ì› ì…ë‹ˆë‹¤.
  - ìœ ì €ëŠ” í˜„ì¬ ì”ì•¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- #### ì£¼ë¬¸ / ê²°ì œ
  - ìœ ì €ëŠ” **ì¦‰ì‹œ ì£¼ë¬¸ ë°©ì‹**ê³¼ **ì¥ë°”êµ¬ë‹ˆë¥¼ í†µí•œ ì£¼ë¬¸ ë°©ì‹**ì„ í†µí•´ ì£¼ë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  - ì¥ë°”êµ¬ë‹ˆëŠ” ìœ ì €ê°€ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸í•˜ë”ë¼ë„ ë‚´ìš©ì´ ìœ ì§€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. 
  - ì£¼ë¬¸ì€ ê¸°ë³¸ì ìœ¼ë¡œ **ê²°ì œ ëŒ€ê¸° ìƒíƒœ**ë¡œ ì €ì¥ë˜ë©°, ê²°ì œ ì—¬ë¶€ì— ë”°ë¼ ì£¼ë¬¸ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
  - ì£¼ë¬¸ ì‹œì ì˜ ì¬ê³  í™•ì¸
    - ì£¼ë¬¸ ë‹¨ê³„ ì‹œì ì— ì¬ê³  ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ë§Œ, ì¬ê³ ë¥¼ í™•ë³´í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. 
    - ì£¼ë¬¸ í›„, ê²°ì œ ì‹œì ì—ì„œ ìƒí’ˆ ì¬ê³ ë¥¼ ë‹¤ì‹œ í™•ì¸ í•˜ë©°, ì¬ê³ ê°€ ë¶€ì¡±í•  ê²½ìš° ê²°ì œëŠ” ì‹¤íŒ¨ ì²˜ë¦¬ë©ë‹ˆë‹¤.
  - ì¥ë°”êµ¬ë‹ˆì— ìˆë˜ ìƒí’ˆì´ ê²°ì œ ì™„ë£Œëœ ê²½ìš°, í•´ë‹¹ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ìë™ìœ¼ë¡œ ì œê±°í•©ë‹ˆë‹¤.   
  - ì¶©ì „ëœ ì”ì•¡ì´ ì¶©ë¶„í•  ê²½ìš°ì—ë§Œ ê²°ì œ ê°€ëŠ¥í•˜ë©°, ê²°ì œ ì‹œ ì´ ê²°ì œ ê¸ˆì•¡ë§Œí¼ ì”ì•¡ì´ ì°¨ê°ë©ë‹ˆë‹¤.
  - ë°ì´í„° ë¶„ì„ì„ ëª©ì ìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ê²°ì œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ê²½ìš° ì‹¤ì‹œê°„ìœ¼ë¡œ ì£¼ë¬¸/ê²°ì œ ì •ë³´ë¥¼ ë°ì´í„° í”Œë«í¼ì— ì „ì†¡í•´ì•¼ í•©ë‹ˆë‹¤.
- #### ì¿ í°
  - ì¿ í°ì€ ê³ ì • í• ì¸ ë°©ì‹ê³¼ ë¹„ìœ¨ í• ì¸ ë°©ì‹ ë‘ ê°€ì§€ë¡œ ë°œê¸‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ìœ ì €ëŠ” ì„ ì°©ìˆœìœ¼ë¡œ í•œì •ëœ ìˆ˜ëŸ‰ì˜ í• ì¸ ì¿ í°ì„ ìµœì´ˆ í•œ ë²ˆë§Œ ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  - ìœ ì €ëŠ” ë°œê¸‰ ë°›ì€ í• ì¸ ì¿ í° ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ìœ ì €ëŠ” ì¿ í°ì€ ë°œê¸‰ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ ì¼ì • ê¸°ê°„ ë‚´ì— ì‚¬ìš©í•´ì•¼ í•˜ë©°, ìœ íš¨ê¸°ê°„ì´ ì§€ë‚˜ë©´ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  - ìœ ì €ëŠ” ì£¼ë¬¸ ê²°ì œ ì‹œ ìœ íš¨í•œ ì¿ í°ì„ í†µí•´ ì „ì²´ ì£¼ë¬¸ ê¸ˆì•¡ì— ëŒ€í•´ í• ì¸ í˜œíƒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

----

## Server Architecture

![](docs/server_architecture_v1.png)

#### â‘  ë‹¤ìˆ˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤

> ë‹¤ìˆ˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ë”ë¼ë„ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ì—†ë„ë¡ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.

- ìœ„ ê¸°ë³¸ ìš”êµ¬ì‚¬í•­ì— ë§ì¶° ë‹¤ì¤‘í™”ëœ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½ì„ ì „ì œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.

#### â‘¡ ë‹¨ì¼ ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤

- ì´ë²ˆ ì£¼ì°¨ ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„(ìƒí’ˆ ì¬ê³ , ê²°ì œ, ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ ë“±)ì— í•„ìš”í•œ **ë™ì‹œì„± ì œì–´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì°¨ì›ì—ì„œ ì²˜ë¦¬**í–ˆìŠµë‹ˆë‹¤.

#### â‘¢ ë©”ì‹œì§€ í

> ë°ì´í„° ë¶„ì„ì„ ëª©ì ìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ê²°ì œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ê²½ìš° ì‹¤ì‹œê°„ìœ¼ë¡œ ì£¼ë¬¸/ê²°ì œ ì •ë³´ë¥¼ ë°ì´í„° í”Œë«í¼ì— ì „ì†¡í•´ì•¼ í•©ë‹ˆë‹¤.

- ì´ë²ˆ ì£¼ì°¨ êµ¬í˜„ì—ì„œëŠ” ë°ì´í„° í”Œë«í¼ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì™¸ë¶€ì— ìˆë‹¤ëŠ” ì ì„ ì „ì œë¡œ í•˜ì—¬, ìƒì„¸ êµ¬í˜„ì€ ì œì™¸í•˜ê³  í”Œë«í¼ í˜¸ì¶œ ë¶€ë¶„ë§Œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

----


## Use Cases

- #### ìœ ì €ëŠ” ìƒí’ˆì„ ì£¼ë¬¸í•œë‹¤.

```mermaid
sequenceDiagram
    autonumber

    participant User as User
    participant API as API Gateway
    participant OrderFacade as Order Facade
    participant ProductService as Product Service
    participant StockService as Stock Service
    participant OrderService as Order Service

%% 1. Order Creation Request
    User ->>+ API: POST /orders
    API ->>+ OrderFacade: Request Order Creation

%% 2. Product Validity Check
    OrderFacade ->>+ ProductService: Validate All Products
    alt Product Validation Failure
        ProductService --x OrderFacade: ProductNotFoundException
        API -->> User: Exception Response
    else Product Validation Success
        ProductService -->>- OrderFacade: All Products Validated
    end

%% 3. Stock Check
    OrderFacade ->>+ StockService: Check Stock for All Products
    alt Insufficient Stock
        StockService --x OrderFacade: ProductOutOfStockException
        API -->> User: Exception Response
    else Sufficient Stock
        StockService -->>- OrderFacade: Stock Checked for All Products
    end

%% 4. Order Data Creation
    OrderFacade ->>+ OrderService: Create and Save Order Data 
    OrderService -->>- OrderFacade: Order ID Created

%% 5. User Response
    OrderFacade -->> API: Return Order ID
    API -->> User: Return Order Form Page URL via Location Header
```

- #### ìœ ì €ëŠ” ì£¼ë¬¸ ìƒí’ˆì„ ê²°ì œí•œë‹¤.

```mermaid
sequenceDiagram
    autonumber

    participant User as User
    participant API as API Gateway
    participant PaymentFacade as Payment Facade
    participant ProductService as Product Service
    participant StockService as Stock Service
    participant PaymentService as Payment Service
    participant OrderService as Order Service
    participant CartService as Cart Service

%% 1. Payment Request
    User ->>+ API: POST /orders/payments
    API ->>+ PaymentFacade: Payment Request

%% 2. Validate Products via Facade
    PaymentFacade ->>+ ProductService: Validate All Products
    alt Product Validation Failure
        ProductService --x PaymentFacade: ProductNotFoundException
        API -->> User: Exception Response
    else Product Validation Success
        ProductService -->>- PaymentFacade: All Products Validated
    end

%% 3. Check Stock via Facade
    PaymentFacade ->>+ StockService: [LOCK ğŸ”’] Check Stock for All Products 
    alt Insufficient Stock
        StockService --x PaymentFacade: ProductOutOfStockException
        API -->> User: Exception Response
    else Sufficient Stock
        StockService -->>- PaymentFacade: Stock Checked for All Products
    end

%% 4. User Payment Balance Check via Facade
    PaymentFacade ->>+ PaymentService: [LOCK ğŸ”’] Check User Balance 
    PaymentService -->>- PaymentFacade: User Balance Information

    alt Insufficient Balance
        PaymentService -->> PaymentFacade: InsufficientBalanceException
        API -->> User: Exception Response
    else Sufficient Balance
    %% 5. Payment Processing via Facade

    %% 5.1 Deduct Balance
        PaymentFacade ->>+ PaymentService: Deduct Balance
        PaymentService -->>- PaymentFacade: Balance Deducted

    %% 5.2 Deduct Stock
        PaymentFacade ->>+ StockService: Deduct Stock 
        StockService -->>- PaymentFacade: Stock Deducted

    %% 5.3 Save Order Data via Order Service
        PaymentFacade ->>+ OrderService: Save Order Data
        OrderService -->>- PaymentFacade: Order Data Saved
    
    %% 5.4 Remove Ordered Products from Cart
        PaymentFacade ->>+ CartService: Remove Ordered Products from Cart If Exists
        CartService -->>- PaymentFacade: Products Removed from Cart

    %% 6. Send Data to Data Platform (Async)
        PaymentFacade ->>+ DataPlatform: [ASYNC] Produce Order Data When Payment Confirmed 
        DataPlatform -->>- PaymentFacade: Ack (Order Data Received) 

    %% 7. Payment Success Response
        PaymentFacade -->> API: Payment Confirmed
        API -->> User: Payment Success Response
    end
```

- #### ìœ ì €ëŠ” ì œí•œëœ ìˆ˜ëŸ‰ì˜ ì¿ í° ë°œê¸‰ì„ ìš”ì²­í•œë‹¤.

```mermaid
sequenceDiagram
    autonumber

    participant User as User
    participant API as API Gateway
    participant CouponService as Coupon Service

%% 1. ì¿ í° ë°œê¸‰ ìš”ì²­
    User ->>+ API: POST /coupons/issues
    API ->>+ CouponService: Issue Coupon

%% 2. ìœ íš¨ì„± ê²€ì‚¬ (ì¤‘ë³µ ì—¬ë¶€ í™•ì¸)
    CouponService ->>+ CouponService: Check if user already has coupon
    alt User Already Has Coupon
        CouponService --x CouponService: CouponAlreadyIssuedException
        API -->> User: Exception Response 
    end

%% 3. ì¿ í° ì¬ê³  í™•ì¸ ë° ê°ì†Œ
    CouponService ->>+ CouponService: [LOCK ğŸ”’] Check Coupon Stock
    alt No Available Stock
        CouponService --x CouponService: CouponOutOfStockException
        API -->> User: Exception Response
    end

%% 4. ìœ ì €-ì¿ í° ê´€ê³„ ì €ì¥
    CouponService ->>+ CouponService: Save User-Coupon Relation

%% 5. ì‘ë‹µ ë°˜í™˜
    CouponService -->> API: Coupon Issued
    API -->> User: Success Response
```

----

## Milestone

![](docs/milestone.png)

- ì´ 3ì£¼ ê°„ì˜ ì¼ì •ì„ ê¸°ì¤€ìœ¼ë¡œ Milestoneì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
- 1MD = í‰ê·  5~6ì‹œê°„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
- ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ ì‹œìŠ¤í…œ, ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ë“±ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ê¸°ìˆ ë“¤ì„ ì‚¬ìš©í•´ë³¸ ê²½í—˜ì´ ì—†ì–´ì„œ 2ì£¼ì°¨ ë‚¨ì€ ì‹œê°„ê³¼, 3ì£¼ì°¨ëŠ” í•´ë‹¹ ê¸°ìˆ ì— ëŒ€í•œ í•™ìŠµê³¼ êµ¬í˜„ì— ì´ˆì ì„ ë§ì·„ìŠµë‹ˆë‹¤.

----

## ERD

![](docs/erd_diagram.png)

----

## API Specification via Swagger

#### FYI. ì´ë²ˆ ì£¼ì°¨ì— API ê¹Œì§€ ì™„ì„±ì´ ë˜ì§€ ì•Šì•„ `Try it`ì€ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤! ì„œë²„ êµ¬ë™ í›„ [Link](http://localhost:8080/swagger-ui/index.html) ì—ì„œë„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤ :-)  

<details>
<summary>Point API</summary>

![](docs/get_point.png)

![](docs/post_charge_point.png)

![](docs/post_deduct_point.png)

</details>

<details>
<summary>Product API</summary>

![](docs/get_all_products.png)

![](docs/get_top_sailing_products.png)

</details>


<details>
<summary>Coupon API</summary>

![](docs/get_available_coupons.png)

![](docs/post_issue_coupon.png)

</details>

<details>
<summary>Order API</summary>

![](docs/post_order.png)

</details>

<details>
<summary>Payment API</summary>

![](docs/post_payment.png)

</details>
